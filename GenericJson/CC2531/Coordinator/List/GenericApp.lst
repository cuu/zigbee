###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.40338/W32 for 8051         25/Jan/2015  16:46:11 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\GenericApp\Source\GenericApp.c     #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\GenericApp\CC2531\..\..\..\Too #
#                          ls\CC2530DB\f8wCoord.cfg" (-DCPU32MHZ              #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\GenericApp\CC2531\..\..\..\Too #
#                          ls\CC2530DB\f8wConfig.cfg" (-DZIGBEEPRO            #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\Source\GenericApp.c" -D          #
#                          ZTOOL_P1 -D MT_TASK -D MT_AF_FUNC -D               #
#                          MT_AF_CB_FUNC -D MT_APP_FUNC -D MT_DEBUG_FUNC -D   #
#                          MT_NWK_FUNC -D MT_NWK_CB_FUNC -D MT_SYS_FUNC -D    #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D MT_UTIL_FUNC -D      #
#                          MT_ZDO_CB_FUNC -D MT_ZDO_MGMT -D                   #
#                          LCD_SUPPORTED=FALSE -D HAL_LCD=FALSE -D            #
#                          HAL_LED=FALSE -D GUU_HAL_LED=TRUE -D NV_INIT -D    #
#                          NV_RESTORE -D xPOWER_SAVING -lC "C:\Texas          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\Coordinator\List\" -lA    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\GenericApp\CC2531\Coordinator\Lis #
#                          t\" --diag_suppress Pe001,Pa010 -o "C:\Texas       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\Coordinator\Obj\" -e      #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\GenericApp\CC2531\" -I         #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\GenericApp\CC2531\..\Source\" -I  #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\GenericApp\CC2531\..\..\..\ZMain\ #
#                          TI2530DB\" -I "C:\Texas Instruments\ZStack-CC2530- #
#                          2.5.1a\Projects\zstack\Samples\GenericApp\CC2531\. #
#                          .\..\..\..\..\Components\hal\include\" -I          #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\GenericApp\CC2531\..\..\..\..\..\ #
#                          Components\hal\target\CC2530USB\" -I "C:\Texas     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \hal\target\CC2530USB\usb\library\" -I "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \hal\target\CC2530USB\usb\library\cc2531\" -I      #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\GenericApp\CC2531\..\..\..\..\..\ #
#                          Components\hal\target\CC2530USB\usb\class_cdc\"    #
#                          -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\GenericApp\CC2531\..\..\..\..\ #
#                          ..\Components\mac\include\" -I "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \mac\high_level\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \mac\low_level\srf04\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \mac\low_level\srf04\single_chip\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \mt\" -I "C:\Texas Instruments\ZStack-CC2530-2.5.1 #
#                          a\Projects\zstack\Samples\GenericApp\CC2531\..\..\ #
#                          ..\..\..\Components\osal\include\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \services\saddr\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \services\sdata\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \stack\af\" -I "C:\Texas                           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \stack\nwk\" -I "C:\Texas                          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \stack\sapi\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \stack\sec\" -I "C:\Texas                          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \stack\sys\" -I "C:\Texas                          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \stack\zdo\" -I "C:\Texas                          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\..\..\..\Components #
#                          \zmac\" -I "C:\Texas Instruments\ZStack-CC2530-2.5 #
#                          .1a\Projects\zstack\Samples\GenericApp\CC2531\..\. #
#                          .\..\..\..\Components\zmac\f8w\" -I "C:\Texas      #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\GenericApp\CC2531\..\..\weikong\Source\"    #
#                          -Ohz --require_prototypes                          #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\GenericApp\CC2531\Coordinator\List #
#                          \GenericApp.lst                                    #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\GenericApp\CC2531\Coordinator\Obj\ #
#                          GenericApp.r51                                     #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\GenericApp\Source\GenericApp.c
      1          /******************************************************************************
      2            Filename:       GenericApp.c
      3            Revised:        $Date: 2012-03-07 01:04:58 -0800 (Wed, 07 Mar 2012) $
      4            Revision:       $Revision: 29656 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License"). You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product. Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          ******************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends "Hello World" to another "Generic"
     45            application every 5 seconds.  The application will also
     46            receives "Hello World" packets.
     47          
     48            The "Hello World" messages are sent/received as MSG type message.
     49          
     50            This applications doesn't have a profile, so it handles everything
     51            directly - itself.
     52          
     53            Key control:
     54              SW1:
     55              SW2:  initiates end device binding
     56              SW3:
     57              SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include "OSAL.h"
     64          #include "AF.h"
     65          #include "ZDApp.h"
     66          #include "ZDObject.h"
     67          #include "ZDProfile.h"
     68          
     69          #include "MT_APP.h"
     70          
     71          #include "GenericApp.h"
     72          #include "DebugTrace.h"
     73          
     74          #if !defined( WIN32 )
     75            #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x80
   \   union <unnamed> volatile __sfr _A_P0
   \                     _A_P0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xa0
   \   union <unnamed> volatile __sfr _A_P2
   \                     _A_P2:
   \   000000                DS 1
     76          #endif
     77          
     78          /* HAL */
     79          #include "hal_lcd.h"
     80          #include "hal_led.h"
     81          #include "hal_key.h"
     82          #include "hal_uart.h"
     83          
     84          #include "guu_common_def.h"
     85          #include "crc.h"
     86          #include "serial.h"
     87          #include "base.h"
     88          #include "guu_timer.h"
     89          #include "guu_key.h"
     90          #include "guu_data.h"
     91          #include "guu_io.h"
     92          #include "guu_init.h"
     93          #include "guu_mt.h"
     94          
     95          /* RTOS */
     96          #if defined( IAR_ARMCM3_LM )
     97          #include "RTOS_App.h"
     98          #endif  
     99          
    100          /*********************************************************************
    101           * MACROS
    102           */
    103          
    104          /*********************************************************************
    105           * CONSTANTS
    106           */
    107          
    108          /*********************************************************************
    109           * TYPEDEFS
    110           */
    111          
    112          /*********************************************************************
    113           * GLOBAL VARIABLES
    114           */
    115          
    116          
    117          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    118          const cId_t GenericApp_ClusterList[GENERICAPP_MAX_CLUSTERS] =
   \                     GenericApp_ClusterList:
   \   000000   0100         DW 1
    119          {
    120            GENERICAPP_CLUSTERID
    121          };
    122          

   \                                 In  segment XDATA_ROM_C, align 1
    123          const SimpleDescriptionFormat_t GenericApp_SimpleDesc =
   \                     GenericApp_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   01           DB 1
   \   000007   ....         DW GenericApp_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW GenericApp_ClusterList
    124          {
    125            GENERICAPP_ENDPOINT,              //  int Endpoint;
    126            GENERICAPP_PROFID,                //  uint16 AppProfId[2];
    127            GENERICAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    128            GENERICAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    129            GENERICAPP_FLAGS,                 //  int   AppFlags:4;
    130            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    131            (cId_t *)GenericApp_ClusterList,  //  byte *pAppInClusterList;
    132            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    133            (cId_t *)GenericApp_ClusterList   //  byte *pAppInClusterList;
    134          };
    135          
    136          // This is the Endpoint/Interface description.  It is defined here, but
    137          // filled-in in GenericApp_Init().  Another way to go would be to fill
    138          // in the structure here and make it a "const" (in code space).  The
    139          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    140          endPointDesc_t GenericApp_epDesc;
   \                     GenericApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    141          
    142          /*********************************************************************
    143           * EXTERNAL VARIABLES
    144           */
    145          extern uint8  guu_sender;
    146          extern uint16 guu_sender_addr;
    147          
    148          /*********************************************************************
    149           * EXTERNAL FUNCTIONS
    150           */
    151          
    152          /*********************************************************************
    153           * LOCAL VARIABLES
    154           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    155          byte GenericApp_TaskID;   // Task ID for internal task/event processing
   \                     GenericApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    156                                    // This variable will be received when
    157                                    // GenericApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    158          devStates_t GenericApp_NwkState;
   \                     GenericApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    159          
    160          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    161          byte GenericApp_TransID;  // This is the unique message ID (counter)
   \                     GenericApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    162          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    163          afAddrType_t GenericApp_DstAddr;
   \                     GenericApp_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    164          
    165          
    166          
    167          /*********************************************************************
    168           * LOCAL FUNCTIONS
    169           */
    170          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    171          static void GenericApp_HandleKeys( byte shift, byte keys );
    172          static void GenericApp_WirelessMSGCB( afIncomingMSGPacket_t *pckt );
    173          static void GenericApp_SendTheMessage( void );
    174          
    175          #if defined( IAR_ARMCM3_LM )
    176          static void GenericApp_ProcessRtosMessage( void );
    177          #endif
    178          
    179          /*********************************************************************
    180           * NETWORK LAYER CALLBACKS
    181           */
    182          
    183          /*********************************************************************
    184           * PUBLIC FUNCTIONS
    185           */
    186          
    187          /*********************************************************************
    188           * @fn      GenericApp_Init
    189           *
    190           * @brief   Initialization function for the Generic App Task.
    191           *          This is called during initialization and should contain
    192           *          any application specific initialization (ie. hardware
    193           *          initialization/setup, table initialization, power up
    194           *          notificaiton ... ).
    195           *
    196           * @param   task_id - the ID assigned by OSAL.  This ID should be
    197           *                    used to send messages and set timers.
    198           *
    199           * @return  none
    200           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    201          void GenericApp_Init( uint8 task_id )
   \                     GenericApp_Init:
    202          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    203            GenericApp_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#GenericApp_TaskID
   \   000009   F0           MOVX    @DPTR,A
    204            GenericApp_NwkState = DEV_INIT;
   \   00000A   90....       MOV     DPTR,#GenericApp_NwkState
   \   00000D   7401         MOV     A,#0x1
   \   00000F   F0           MOVX    @DPTR,A
    205            GenericApp_TransID = 0;
   \   000010   90....       MOV     DPTR,#GenericApp_TransID
   \   000013   E4           CLR     A
   \   000014   F0           MOVX    @DPTR,A
    206          
    207            // Device hardware initialization can be added here or in main() (Zmain.c).
    208            // If the hardware is application specific - add it here.
    209            // If the hardware is other parts of the device add it in main().
    210          
    211          
    212            GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000015   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   000018   7402         MOV     A,#0x2
   \   00001A   F0           MOVX    @DPTR,A
    213            GenericApp_DstAddr.endPoint = GENERICAPP_ENDPOINT;
   \   00001B   A3           INC     DPTR
   \   00001C   740A         MOV     A,#0xa
   \   00001E   F0           MOVX    @DPTR,A
    214            GenericApp_DstAddr.addr.shortAddr = 0xFFFF;
   \   00001F   90....       MOV     DPTR,#GenericApp_DstAddr
   \   000022   74FF         MOV     A,#-0x1
   \   000024   F0           MOVX    @DPTR,A
   \   000025   A3           INC     DPTR
   \   000026   F0           MOVX    @DPTR,A
    215            
    216          
    217            // Fill out the endpoint description.
    218            GenericApp_epDesc.endPoint = GENERICAPP_ENDPOINT;
   \   000027   90....       MOV     DPTR,#GenericApp_epDesc
   \   00002A   740A         MOV     A,#0xa
   \   00002C   F0           MOVX    @DPTR,A
    219            GenericApp_epDesc.task_id = &GenericApp_TaskID;
   \   00002D   A3           INC     DPTR
   \   00002E   74..         MOV     A,#GenericApp_TaskID & 0xff
   \   000030   F0           MOVX    @DPTR,A
   \   000031   A3           INC     DPTR
   \   000032   74..         MOV     A,#(GenericApp_TaskID >> 8) & 0xff
   \   000034   F0           MOVX    @DPTR,A
    220            GenericApp_epDesc.simpleDesc
    221                      = (SimpleDescriptionFormat_t *)&GenericApp_SimpleDesc;
   \   000035   A3           INC     DPTR
   \   000036   74..         MOV     A,#GenericApp_SimpleDesc & 0xff
   \   000038   F0           MOVX    @DPTR,A
   \   000039   A3           INC     DPTR
   \   00003A   74..         MOV     A,#(GenericApp_SimpleDesc >> 8) & 0xff
   \   00003C   F0           MOVX    @DPTR,A
    222            GenericApp_epDesc.latencyReq = noLatencyReqs;// ???
   \   00003D   A3           INC     DPTR
   \   00003E   E4           CLR     A
   \   00003F   F0           MOVX    @DPTR,A
    223          
    224            // Register the endpoint description with the AF
    225            afRegister( &GenericApp_epDesc );
   \   000040                ; Setup parameters for call to function afRegister
   \   000040   7A..         MOV     R2,#GenericApp_epDesc & 0xff
   \   000042   7B..         MOV     R3,#(GenericApp_epDesc >> 8) & 0xff
   \   000044   12....       LCALL   ??afRegister?relay
    226          
    227            // Register for all key events - This app will handle all key events
    228            RegisterForKeys( GenericApp_TaskID );//这儿把Hal_key绑在一起了
   \   000047                ; Setup parameters for call to function RegisterForKeys
   \   000047   90....       MOV     DPTR,#GenericApp_TaskID
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   F9           MOV     R1,A
   \   00004C   12....       LCALL   ??RegisterForKeys?relay
    229            // onboard.c中,OnBoard_SendKeys会根据这个taskid,发送KEY_CHANGE事件 
    230            
    231          
    232            // Update the display
    233          #if defined ( LCD_SUPPORTED )
    234            HalLcdWriteString( "GenericApp", HAL_LCD_LINE_1 );
   \   00004F                ; Setup parameters for call to function HalLcdWriteString
   \   00004F   7901         MOV     R1,#0x1
   \   000051   7A..         MOV     R2,#`?<Constant "GenericApp">` & 0xff
   \   000053   7B..         MOV     R3,#(`?<Constant "GenericApp">` >> 8) & 0xff
   \   000055   12....       LCALL   ??HalLcdWriteString?relay
    235          #endif
    236          
    237            ZDO_RegisterForZDOMsg( GenericApp_TaskID, End_Device_Bind_rsp );
   \   000058                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000058   7A20         MOV     R2,#0x20
   \   00005A   7B80         MOV     R3,#-0x80
   \   00005C   90....       MOV     DPTR,#GenericApp_TaskID
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   F9           MOV     R1,A
   \   000061   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    238            ZDO_RegisterForZDOMsg( GenericApp_TaskID, Match_Desc_rsp );
   \   000064                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000064   7A06         MOV     R2,#0x6
   \   000066   7B80         MOV     R3,#-0x80
   \   000068   90....       MOV     DPTR,#GenericApp_TaskID
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   F9           MOV     R1,A
   \   00006D   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    239          
    240          #if defined( IAR_ARMCM3_LM )
    241            // Register this task with RTOS task initiator
    242            RTOS_RegisterApp( task_id, GENERICAPP_RTOS_MSG_EVT );
    243          #endif
    244            
    245            //guu_serial_init();
    246            sw_arr[0]=NULL;
   \   000070   90....       MOV     DPTR,#sw_arr
   \   000073   E4           CLR     A
   \   000074   F0           MOVX    @DPTR,A
   \   000075   A3           INC     DPTR
   \   000076   F0           MOVX    @DPTR,A
    247            sw_arr[1]=NULL;
   \   000077   A3           INC     DPTR
   \   000078   F0           MOVX    @DPTR,A
   \   000079   A3           INC     DPTR
   \   00007A   F0           MOVX    @DPTR,A
    248            sw_arr[2]=NULL;
   \   00007B   A3           INC     DPTR
   \   00007C   F0           MOVX    @DPTR,A
   \   00007D   A3           INC     DPTR
   \   00007E   F0           MOVX    @DPTR,A
    249            sw_arr[3]=NULL;
   \   00007F   A3           INC     DPTR
   \   000080   F0           MOVX    @DPTR,A
   \   000081   A3           INC     DPTR
   \   000082   F0           MOVX    @DPTR,A
    250          }
   \   000083   02....       LJMP    ??Subroutine7_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine7_0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    251          
    252          /*********************************************************************
    253           * @fn      GenericApp_ProcessEvent
    254           *
    255           * @brief   Generic Application Task event processor.  This function
    256           *          is called to process all events for the task.  Events
    257           *          include timers, messages and any other user defined events.
    258           *
    259           * @param   task_id  - The OSAL assigned task ID.
    260           * @param   events - events to process.  This is a bit map and can
    261           *                   contain more than one event.
    262           *
    263           * @return  none
    264           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    265          uint16 GenericApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     GenericApp_ProcessEvent:
    266          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    267            afIncomingMSGPacket_t *MSGpkt;
    268            afDataConfirm_t *afDataConfirm;
    269          
    270            // Data Confirmation message fields
    271            byte sentEP;
    272            ZStatus_t sentStatus;
    273            byte sentTransID;       // This should match the value sent
    274            (void)task_id;  // Intentionally unreferenced parameter
    275          
    276            if ( events & SYS_EVENT_MSG )
   \   00000E   EB           MOV     A,R3
   \   00000F   5480         ANL     A,#0x80
   \   000011   7003         JNZ     $+5
   \   000013   02....       LJMP    ??GenericApp_ProcessEvent_0 & 0xFFFF
    277            {
    278              //czv7 寻找 afIncomingMSGPacket_t可以助理解内部流程，底层的数据如何发到 GenericApp_ProcessEvent
    279              //czv7 这儿来的，只有这个结构体的信息，是一切ProcessEvent理解的核心引线
    280              
    281              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000016                ; Setup parameters for call to function osal_msg_receive
   \   000016   800E         SJMP    ??GenericApp_ProcessEvent_1
    282              while ( MSGpkt )
    283              {
    284                switch ( MSGpkt->hdr.event )
    285                {
    286                  case ZDO_CB_MSG:
    287                    GenericApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    288                    break;
    289          
    290                  case KEY_CHANGE:
    291                    GenericApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    292                    break;
    293          
    294                  case AF_DATA_CONFIRM_CMD:
    295                    // This message is received as a confirmation of a data packet sent.
    296                    // The status is of ZStatus_t type [defined in ZComDef.h]
    297                    // The message fields are defined in AF.h
    298                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    299                    sentEP = afDataConfirm->endpoint;
    300                    sentStatus = afDataConfirm->hdr.status;
    301                    sentTransID = afDataConfirm->transID;
    302                    (void)sentEP;
    303                    (void)sentTransID;
    304          
    305                    // Action taken when confirmation is received.
    306                    if ( sentStatus != ZSuccess )
    307                    {
    308                      // The data wasn't delivered -- Do something
    309                      //我的上位机 的websocket队列机制倒是和这个 不断增加TransId的规则很像
    310                      //可以成为 上位机 的一部分，结合起来，最终可以确定，哪条命令失败
    311                      //然后由上位机，发起重新发送的行为
    312                      //这儿是无法保存 历史命令的
    313                      // JavaScript 中其实保留了历史记录
    314                    }
    315                    break;
    316          
    317                  case AF_INCOMING_MSG_CMD:
    318                    GenericApp_WirelessMSGCB( MSGpkt );
    319                    break;
    320          
    321                  case ZDO_STATE_CHANGE:
    322                    GenericApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    323                    if ( (GenericApp_NwkState == DEV_ZB_COORD)
    324                        || (GenericApp_NwkState == DEV_ROUTER)
    325                        || (GenericApp_NwkState == DEV_END_DEVICE) )
    326                    {
    327          						uint16 tmp;
    328          						guu_osal_nv_read(NV_SHORTADDR,0,sizeof(uint16),(uint8*)&tmp);
    329          						if(tmp != _NIB.nwkDevAddress)
    330          						{
    331          							guu_osal_nv_write(NV_SHORTADDR,0,sizeof(uint16),(uint8*)&_NIB.nwkDevAddress);
    332          							guu_usart((uint8*)&_NIB.nwkDevAddress,2);
    333          						}
    334                      // Start sending "the" message in a regular interval.
    335                      osal_set_event(Guu_TaskID, ZDO_STATE_CHANGE);
    336                    }
    337                    break;
    338                case MT_SYS_APP_MSG:
    339                  {
    340                    //由Z-tools中APP_MSG产生的系统事件,只要endpoint是GENERICAPP_ENDPOINT就可以发到这儿了
    341                    //guu_proc_sys_app_msg((mtSysAppMsg_t *)MSGpkt);
    342          					//HalLedSet (HAL_LED_1, HAL_LED_MODE_BLINK); 
    343          					//这儿要写一个cb处理,回到guu_mt.c 
    344          					//(mtSysAppMsg_t*)MSGpkt
    345          					guu_mt_app_msg_cb( (mtSysAppMsg_t*)MSGpkt );
   \                     ??GenericApp_ProcessEvent_2:
   \   000018                ; Setup parameters for call to function guu_mt_app_msg_cb
   \   000018   EE           MOV     A,R6
   \   000019   FA           MOV     R2,A
   \   00001A   EF           MOV     A,R7
   \   00001B   FB           MOV     R3,A
   \   00001C   12....       LCALL   ??guu_mt_app_msg_cb?relay
    346                  }break;
    347                  default:
    348                    break;
    349                }
    350          
    351                // Release the memory
    352                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_3:
   \   00001F                ; Setup parameters for call to function osal_msg_deallocate
   \   00001F   EE           MOV     A,R6
   \   000020   FA           MOV     R2,A
   \   000021   EF           MOV     A,R7
   \   000022   FB           MOV     R3,A
   \   000023   12....       LCALL   ??osal_msg_deallocate?relay
    353          
    354                // Next,until NULL 
    355                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000026                ; Setup parameters for call to function osal_msg_receive
   \                     ??GenericApp_ProcessEvent_1:
   \   000026   90....       MOV     DPTR,#GenericApp_TaskID
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F9           MOV     R1,A
   \   00002B   12....       LCALL   ??osal_msg_receive?relay
   \   00002E   8A..         MOV     ?V0 + 2,R2
   \   000030   8B..         MOV     ?V0 + 3,R3
   \   000032   AE..         MOV     R6,?V0 + 2
   \   000034   AF..         MOV     R7,?V0 + 3
   \   000036   EE           MOV     A,R6
   \   000037   4F           ORL     A,R7
   \   000038   7003         JNZ     $+5
   \   00003A   02....       LJMP    ??GenericApp_ProcessEvent_4 & 0xFFFF
   \   00003D   8E82         MOV     DPL,R6
   \   00003F   8F83         MOV     DPH,R7
   \   000041   E0           MOVX    A,@DPTR
   \   000042   24E6         ADD     A,#-0x1a
   \   000044   6045         JZ      ??GenericApp_ProcessEvent_5
   \   000046   24F7         ADD     A,#-0x9
   \   000048   60CE         JZ      ??GenericApp_ProcessEvent_2
   \   00004A   2463         ADD     A,#0x63
   \   00004C   602B         JZ      ??GenericApp_ProcessEvent_6
   \   00004E   24EF         ADD     A,#-0x11
   \   000050   6042         JZ      ??GenericApp_ProcessEvent_7
   \   000052   24FE         ADD     A,#-0x2
   \   000054   70C9         JNZ     ??GenericApp_ProcessEvent_3
   \   000056   EE           MOV     A,R6
   \   000057   240C         ADD     A,#0xc
   \   000059   F582         MOV     DPL,A
   \   00005B   EF           MOV     A,R7
   \   00005C   12....       LCALL   ??Subroutine10_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   00005F   6406         XRL     A,#0x6
   \   000061   7004         JNZ     ??GenericApp_ProcessEvent_8
   \   000063   A3           INC     DPTR
   \   000064   E0           MOVX    A,@DPTR
   \   000065   6480         XRL     A,#0x80
   \                     ??GenericApp_ProcessEvent_8:
   \   000067   70B6         JNZ     ??GenericApp_ProcessEvent_3
   \   000069                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   000069   EE           MOV     A,R6
   \   00006A   FA           MOV     R2,A
   \   00006B   EF           MOV     A,R7
   \   00006C   FB           MOV     R3,A
   \   00006D   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000070   EA           MOV     A,R2
   \   000071   4B           ORL     A,R3
   \   000072   60AB         JZ      ??GenericApp_ProcessEvent_3
   \   000074                ; Setup parameters for call to function guu_osal_mem_free
   \   000074   12....       LCALL   ??guu_osal_mem_free?relay
   \   000077   80A6         SJMP    ??GenericApp_ProcessEvent_3
   \                     ??GenericApp_ProcessEvent_6:
   \   000079                ; Setup parameters for call to function GenericApp_HandleKeys
   \   000079   A3           INC     DPTR
   \   00007A   A3           INC     DPTR
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   FA           MOV     R2,A
   \   00007E   8E82         MOV     DPL,R6
   \   000080   8F83         MOV     DPH,R7
   \   000082   A3           INC     DPTR
   \   000083   A3           INC     DPTR
   \   000084   E0           MOVX    A,@DPTR
   \   000085   F9           MOV     R1,A
   \   000086   12....       LCALL   ??GenericApp_HandleKeys?relay
   \   000089   8094         SJMP    ??GenericApp_ProcessEvent_3
   \                     ??GenericApp_ProcessEvent_5:
   \   00008B                ; Setup parameters for call to function GenericApp_WirelessMSGCB
   \   00008B   EE           MOV     A,R6
   \   00008C   FA           MOV     R2,A
   \   00008D   EF           MOV     A,R7
   \   00008E   FB           MOV     R3,A
   \   00008F   12....       LCALL   ??GenericApp_WirelessMSGCB?relay
   \   000092   808B         SJMP    ??GenericApp_ProcessEvent_3
   \                     ??GenericApp_ProcessEvent_7:
   \   000094   A3           INC     DPTR
   \   000095   E0           MOVX    A,@DPTR
   \   000096   90....       MOV     DPTR,#GenericApp_NwkState
   \   000099   F0           MOVX    @DPTR,A
   \   00009A   6409         XRL     A,#0x9
   \   00009C   600D         JZ      ??GenericApp_ProcessEvent_9
   \   00009E   E0           MOVX    A,@DPTR
   \   00009F   6407         XRL     A,#0x7
   \   0000A1   6008         JZ      ??GenericApp_ProcessEvent_9
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   6406         XRL     A,#0x6
   \   0000A6   6003         JZ      $+5
   \   0000A8   02....       LJMP    ??GenericApp_ProcessEvent_3 & 0xFFFF
   \                     ??GenericApp_ProcessEvent_9:
   \   0000AB                ; Setup parameters for call to function guu_osal_nv_read
   \   0000AB   85..82       MOV     DPL,?XSP + 0
   \   0000AE   85..83       MOV     DPH,?XSP + 1
   \   0000B1   8582..       MOV     ?V0 + 2,DPL
   \   0000B4   8583..       MOV     ?V0 + 3,DPH
   \   0000B7   78..         MOV     R0,#?V0 + 2
   \   0000B9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000BC   75..02       MOV     ?V0 + 2,#0x2
   \   0000BF   75..00       MOV     ?V0 + 3,#0x0
   \   0000C2   78..         MOV     R0,#?V0 + 2
   \   0000C4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C7   7C00         MOV     R4,#0x0
   \   0000C9   7D00         MOV     R5,#0x0
   \   0000CB   7A03         MOV     R2,#0x3
   \   0000CD   7B04         MOV     R3,#0x4
   \   0000CF   12....       LCALL   ??guu_osal_nv_read?relay
   \   0000D2   7404         MOV     A,#0x4
   \   0000D4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000D7   85..82       MOV     DPL,?XSP + 0
   \   0000DA   85..83       MOV     DPH,?XSP + 1
   \   0000DD   E0           MOVX    A,@DPTR
   \   0000DE   F8           MOV     R0,A
   \   0000DF   A3           INC     DPTR
   \   0000E0   E0           MOVX    A,@DPTR
   \   0000E1   F9           MOV     R1,A
   \   0000E2   90....       MOV     DPTR,#_NIB + 20
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   68           XRL     A,R0
   \   0000E7   7003         JNZ     ??GenericApp_ProcessEvent_10
   \   0000E9   A3           INC     DPTR
   \   0000EA   E0           MOVX    A,@DPTR
   \   0000EB   69           XRL     A,R1
   \                     ??GenericApp_ProcessEvent_10:
   \   0000EC   602F         JZ      ??GenericApp_ProcessEvent_11
   \   0000EE                ; Setup parameters for call to function guu_osal_nv_write
   \   0000EE   75....       MOV     ?V0 + 2,#(_NIB + 20) & 0xff
   \   0000F1   75....       MOV     ?V0 + 3,#((_NIB + 20) >> 8) & 0xff
   \   0000F4   78..         MOV     R0,#?V0 + 2
   \   0000F6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F9   75..02       MOV     ?V0 + 2,#0x2
   \   0000FC   75..00       MOV     ?V0 + 3,#0x0
   \   0000FF   78..         MOV     R0,#?V0 + 2
   \   000101   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000104   7C00         MOV     R4,#0x0
   \   000106   7D00         MOV     R5,#0x0
   \   000108   7A03         MOV     R2,#0x3
   \   00010A   7B04         MOV     R3,#0x4
   \   00010C   12....       LCALL   ??guu_osal_nv_write?relay
   \   00010F   7404         MOV     A,#0x4
   \   000111   12....       LCALL   ?DEALLOC_XSTACK8
   \   000114                ; Setup parameters for call to function guu_usart
   \   000114   7902         MOV     R1,#0x2
   \   000116   7A..         MOV     R2,#(_NIB + 20) & 0xff
   \   000118   7B..         MOV     R3,#((_NIB + 20) >> 8) & 0xff
   \   00011A   12....       LCALL   ??guu_usart?relay
   \                     ??GenericApp_ProcessEvent_11:
   \   00011D                ; Setup parameters for call to function osal_set_event
   \   00011D   7AD1         MOV     R2,#-0x2f
   \   00011F   7B00         MOV     R3,#0x0
   \   000121   90....       MOV     DPTR,#Guu_TaskID
   \   000124   E0           MOVX    A,@DPTR
   \   000125   F9           MOV     R1,A
   \   000126   12....       LCALL   ??osal_set_event?relay
   \   000129   02....       LJMP    ??GenericApp_ProcessEvent_3 & 0xFFFF
    356              }
    357          
    358              // return unprocessed events
    359              return (events ^ SYS_EVENT_MSG);
   \                     ??GenericApp_ProcessEvent_4:
   \   00012C   AA..         MOV     R2,?V0 + 0
   \   00012E   E5..         MOV     A,?V0 + 1
   \   000130   6480         XRL     A,#0x80
   \   000132   FB           MOV     R3,A
   \   000133   800E         SJMP    ??GenericApp_ProcessEvent_12
    360            }
    361          
    362            //  (setup in GenericApp_Init()).
    363            if ( events & GENERICAPP_SEND_MSG_EVT )
   \                     ??GenericApp_ProcessEvent_0:
   \   000135   EA           MOV     A,R2
   \   000136   A2E0         MOV     C,0xE0 /* A   */.0
   \   000138   5005         JNC     ??GenericApp_ProcessEvent_13
    364            {
    365              
    366              // return unprocessed events
    367              return (events ^ GENERICAPP_SEND_MSG_EVT);
   \   00013A   6401         XRL     A,#0x1
   \   00013C   FA           MOV     R2,A
   \   00013D   8004         SJMP    ??GenericApp_ProcessEvent_12
    368            }
    369          
    370            
    371          #if defined( IAR_ARMCM3_LM )
    372            // Receive a message from the RTOS queue
    373            if ( events & GENERICAPP_RTOS_MSG_EVT )
    374            {
    375              // Process message from RTOS queue
    376              GenericApp_ProcessRtosMessage();
    377          
    378              // return unprocessed events
    379              return (events ^ GENERICAPP_RTOS_MSG_EVT);
    380            }
    381          #endif
    382          
    383            // Discard unknown events
    384            return 0;
   \                     ??GenericApp_ProcessEvent_13:
   \   00013F   7A00         MOV     R2,#0x0
   \   000141   7B00         MOV     R3,#0x0
   \                     ??GenericApp_ProcessEvent_12:
   \   000143   7402         MOV     A,#0x2
   \   000145   12....       LCALL   ?DEALLOC_XSTACK8
   \   000148   7F04         MOV     R7,#0x4
   \   00014A   02....       LJMP    ?BANKED_LEAVE_XDATA
    385          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine10_0:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   E0           MOVX    A,@DPTR
   \   000005   22           RET
    386          
    387          /*********************************************************************
    388           * Event Generation Functions
    389           */
    390          
    391          /*********************************************************************
    392           * @fn      GenericApp_ProcessZDOMsgs()
    393           *
    394           * @brief   Process response messages
    395           *
    396           * @param   none
    397           *
    398           * @return  none
    399           */
    400          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    401          {
    402            switch ( inMsg->clusterID )
    403            {
    404              case End_Device_Bind_rsp:
    405                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    406                {
    407                    
    408                }
    409          #if defined( BLINK_LEDS )
    410                else
    411                {
    412                  // Flash LED to show failure
    413                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
    414                
    415                }
    416          #endif
    417                break;
    418          
    419              case Match_Desc_rsp:
    420                {
    421                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    422                  if ( pRsp )
    423                  {
    424                    guu_osal_mem_free( pRsp );
    425                  }
    426                }
    427                break;
    428            }
    429          }
    430          
    431          /*********************************************************************
    432           * @fn      GenericApp_HandleKeys
    433           *
    434           * @brief   Handles all key events for this device.
    435           *
    436           * @param   shift - true if in shift/alt.
    437           * @param   keys - bit field for key events. Valid entries:
    438           *                 HAL_KEY_SW_4
    439           *                 HAL_KEY_SW_3
    440           *                 HAL_KEY_SW_2
    441           *                 HAL_KEY_SW_1
    442           *
    443           * @return  none
    444           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    445          static void GenericApp_HandleKeys( uint8 shift, uint8 keys )
   \                     GenericApp_HandleKeys:
    446          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
    447            uint8 tmp;
                         ^
Warning[Pe550]: variable "tmp" was set but never used
    448            uint8 n;
    449            uint8 io;
    450            uint8 d;
                         ^
Warning[Pe550]: variable "d" was set but never used
    451            
    452            tmp = 0;
    453            n = 0;
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   E4           CLR     A
   \   000013   F0           MOVX    @DPTR,A
    454            io = 0;
   \   000014   FF           MOV     R7,A
    455            d = 0;
    456            if ( keys & HAL_KEY_SW_4 ) //p1.4, 10,0x0a ,5
   \   000015   EE           MOV     A,R6
   \   000016   A2E3         MOV     C,0xE0 /* A   */.3
   \   000018   500A         JNC     ??GenericApp_HandleKeys_0
    457            {
    458              //uprint("P1_4");
    459              io = P1_4;
   \   00001A   A294         MOV     C,0x90.4
   \   00001C   E4           CLR     A
   \   00001D   33           RLC     A
   \   00001E   FF           MOV     R7,A
    460              n = 4;
   \   00001F   7404         MOV     A,#0x4
   \   000021   F0           MOVX    @DPTR,A
    461              d = 0x0a;
    462              (PUSH1_POLARITY(P0_4));
   \   000022   E580         MOV     A,0x80
    463              
    464              
    465            }
    466            if ( keys & HAL_KEY_SW_5 ) //p2.0, 12,0x0c, 7
   \                     ??GenericApp_HandleKeys_0:
   \   000024   EE           MOV     A,R6
   \   000025   A2E2         MOV     C,0xE0 /* A   */.2
   \   000027   5008         JNC     ??GenericApp_HandleKeys_1
    467            {
    468              //uprint("P2_0");
    469              io = P2_0;
   \   000029   A2A0         MOV     C,0xa0.0
   \   00002B   E4           CLR     A
   \   00002C   33           RLC     A
   \   00002D   FF           MOV     R7,A
    470              n = 3;
   \   00002E   7403         MOV     A,#0x3
   \   000030   F0           MOVX    @DPTR,A
    471              d = 12;
    472            }
    473            
    474            if ( keys & HAL_KEY_SW_6 ) //p0.0, 0
   \                     ??GenericApp_HandleKeys_1:
   \   000031   EE           MOV     A,R6
   \   000032   A2E5         MOV     C,0xE0 /* A   */.5
   \   000034   5008         JNC     ??GenericApp_HandleKeys_2
    475            {
    476              //uprint("P0_0");
    477              io = P0_0;
   \   000036   A280         MOV     C,0x80.0
   \   000038   E4           CLR     A
   \   000039   33           RLC     A
   \   00003A   FF           MOV     R7,A
    478              n = 1;
   \   00003B   7401         MOV     A,#0x1
   \   00003D   F0           MOVX    @DPTR,A
    479              d = 0;
    480            }
    481            
    482            if ( keys & HAL_KEY_SW_7 ) // p1.2, 8
   \                     ??GenericApp_HandleKeys_2:
   \   00003E   EE           MOV     A,R6
   \   00003F   A2E6         MOV     C,0xE0 /* A   */.6
   \   000041   5008         JNC     ??GenericApp_HandleKeys_3
    483            {
    484              //uprint("P1_2");
    485              io = P1_2;
   \   000043   A292         MOV     C,0x90.2
   \   000045   E4           CLR     A
   \   000046   33           RLC     A
   \   000047   FF           MOV     R7,A
    486              n = 2;
   \   000048   7402         MOV     A,#0x2
   \   00004A   F0           MOVX    @DPTR,A
    487              d = 8;
    488            }
    489            
    490            if(get_key_type(n) == BE_BUTTON)
   \                     ??GenericApp_HandleKeys_3:
   \   00004B                ; Setup parameters for call to function get_key_type
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F9           MOV     R1,A
   \   00004D   12....       LCALL   ??get_key_type?relay
    491            {
    492              //send_button_event_to_server(n);
    493            }
    494            n--;
   \   000050   85..82       MOV     DPL,?XSP + 0
   \   000053   85..83       MOV     DPH,?XSP + 1
   \   000056   E0           MOVX    A,@DPTR
   \   000057   14           DEC     A
   \   000058   F0           MOVX    @DPTR,A
    495            if(sw_arr[n] !=NULL)
   \   000059   C3           CLR     C
   \   00005A   33           RLC     A
   \   00005B   F8           MOV     R0,A
   \   00005C   E4           CLR     A
   \   00005D   33           RLC     A
   \   00005E   F9           MOV     R1,A
   \   00005F   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000062   F9           MOV     R1,A
   \   000063   E8           MOV     A,R0
   \   000064   49           ORL     A,R1
   \   000065   6050         JZ      ??GenericApp_HandleKeys_4
    496            {
    497              if(io)
   \   000067   EF           MOV     A,R7
   \   000068   A2E0         MOV     C,0xE0 /* A   */.0
   \   00006A   85..82       MOV     DPL,?XSP + 0
   \   00006D   85..83       MOV     DPH,?XSP + 1
   \   000070   E0           MOVX    A,@DPTR
   \   000071   5029         JNC     ??GenericApp_HandleKeys_5
    498              {
    499                //usart_debug(&sw_arr[n][0], 5);
    500                //exec_proto( saddr, sw_arr[n][3], sw_arr[n][4] ); 
    501                if(sw_arr[n]->cmd_t.cmd == 0xef) sw_arr[n]->cmd_t.cmd = 0xed;
   \   000073   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000076   64EF         XRL     A,#0xef
   \   000078   7006         JNZ     ??GenericApp_HandleKeys_6
   \   00007A   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   00007D   74ED         MOV     A,#-0x13
   \   00007F   F0           MOVX    @DPTR,A
    502                if(sw_arr[n]->cmd_t.cmd == 0xf0) sw_arr[n]->cmd_t.cmd = 0xf1;
   \                     ??GenericApp_HandleKeys_6:
   \   000080   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000083   64F0         XRL     A,#0xf0
   \   000085   7006         JNZ     ??GenericApp_HandleKeys_7
   \   000087   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00008A   74F1         MOV     A,#-0xf
   \                     ??GenericApp_HandleKeys_8:
   \   00008C   F0           MOVX    @DPTR,A
    503                exec_io( (io_cmd_t*)&n);
   \                     ??GenericApp_HandleKeys_7:
   \   00008D                ; Setup parameters for call to function exec_io
   \   00008D   85..82       MOV     DPL,?XSP + 0
   \   000090   85..83       MOV     DPH,?XSP + 1
   \   000093   AA82         MOV     R2,DPL
   \   000095   AB83         MOV     R3,DPH
   \   000097   12....       LCALL   ??exec_io?relay
   \   00009A   8028         SJMP    ??GenericApp_HandleKeys_9
    504              }else 
    505              {
    506                if(sw_arr[n]->cmd_t.cmd == 0xed) sw_arr[n]->cmd_t.cmd = 0xef;
   \                     ??GenericApp_HandleKeys_5:
   \   00009C   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   00009F   64ED         XRL     A,#0xed
   \   0000A1   7006         JNZ     ??GenericApp_HandleKeys_10
   \   0000A3   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   0000A6   74EF         MOV     A,#-0x11
   \   0000A8   F0           MOVX    @DPTR,A
    507                if(sw_arr[n]->cmd_t.cmd == 0xf1) sw_arr[n]->cmd_t.cmd = 0xf0;
   \                     ??GenericApp_HandleKeys_10:
   \   0000A9   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   0000AC   64F1         XRL     A,#0xf1
   \   0000AE   70DD         JNZ     ??GenericApp_HandleKeys_7
   \   0000B0   12....       LCALL   ?Subroutine2 & 0xFFFF
    508                exec_io( (io_cmd_t*)&n);
    509              }
    510            }else //update sw_arr
   \                     ??CrossCallReturnLabel_6:
   \   0000B3   74F0         MOV     A,#-0x10
   \   0000B5   80D5         SJMP    ??GenericApp_HandleKeys_8
    511            {
    512              
    513              exec_io_cmd((io_cmd_t*)&n);
   \                     ??GenericApp_HandleKeys_4:
   \   0000B7                ; Setup parameters for call to function exec_io_cmd
   \   0000B7   85..82       MOV     DPL,?XSP + 0
   \   0000BA   85..83       MOV     DPH,?XSP + 1
   \   0000BD   AA82         MOV     R2,DPL
   \   0000BF   AB83         MOV     R3,DPH
   \   0000C1   12....       LCALL   ??exec_io_cmd?relay
    514              //osal_set_event(GenericApp_TaskID, EXEC_FLASH_PROTO);//这步会导入数据到 sw_arr中 
    515            }
    516          }
   \                     ??GenericApp_HandleKeys_9:
   \   0000C4   7401         MOV     A,#0x1
   \   0000C6                REQUIRE ?Subroutine0
   \   0000C6                REQUIRE _A_P1
   \   0000C6                REQUIRE _A_P0
   \   0000C6                REQUIRE _A_P2
   \   0000C6                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine7_0
   \   000003                ; // Fall through to label ??Subroutine7_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E0           MOVX    A,@DPTR
   \   000007                REQUIRE ??Subroutine8_0
   \   000007                ; // Fall through to label ??Subroutine8_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine8_0:
   \   000000   C3           CLR     C
   \   000001   33           RLC     A
   \   000002   F8           MOV     R0,A
   \   000003   E4           CLR     A
   \   000004   33           RLC     A
   \   000005   F9           MOV     R1,A
   \   000006   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E0           MOVX    A,@DPTR
   \   000007   C3           CLR     C
   \   000008   33           RLC     A
   \   000009   F8           MOV     R0,A
   \   00000A   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000003   F583         MOV     DPH,A
   \   000005   8882         MOV     DPL,R0
   \   000007   A3           INC     DPTR
   \   000008   A3           INC     DPTR
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   74..         MOV     A,#sw_arr & 0xff
   \   000002   28           ADD     A,R0
   \   000003   F582         MOV     DPL,A
   \   000005   74..         MOV     A,#(sw_arr >> 8) & 0xff
   \   000007   39           ADDC    A,R1
   \   000008   F583         MOV     DPH,A
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F8           MOV     R0,A
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   22           RET
    517          
    518          /*********************************************************************
    519           * LOCAL FUNCTIONS
    520           */
    521          
    522          /*********************************************************************
    523           * @fn      GenericApp_MessageMSGCB
    524           *
    525           * @brief   Data message processor callback.  This function processes
    526           *          any incoming data - probably from other devices.  So, based
    527           *          on cluster ID, perform the intended action.
    528           *
    529           * @param   none
    530           *
    531           * @return  none
    532           */
    533          //无线函数

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    534          static void GenericApp_WirelessMSGCB( afIncomingMSGPacket_t *pkt )
   \                     GenericApp_WirelessMSGCB:
    535          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    536            
    537            switch ( pkt->clusterId )
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   6401         XRL     A,#0x1
   \   000015   7002         JNZ     ??GenericApp_WirelessMSGCB_0
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \                     ??GenericApp_WirelessMSGCB_0:
   \   000019   6003         JZ      $+5
   \   00001B   02....       LJMP    ??GenericApp_WirelessMSGCB_1 & 0xFFFF
    538            {
    539              case GENERICAPP_CLUSTERID:   
    540                
    541              if( pkt->cmd.Data[0] == WIRE_PING_CMD)
   \   00001E   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000021   F8           MOV     R0,A
   \   000022   A3           INC     DPTR
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F583         MOV     DPH,A
   \   000026   8882         MOV     DPL,R0
   \   000028   E0           MOVX    A,@DPTR
   \   000029   6451         XRL     A,#0x51
   \   00002B   6003         JZ      $+5
   \   00002D   02....       LJMP    ??GenericApp_WirelessMSGCB_2 & 0xFFFF
    542                {
    543                    uint8 buf[10];
    544                    uint8*u8p;
    545                    u8p = (uint8*)&pkt->timestamp;          
   \   000030   EA           MOV     A,R2
   \   000031   241A         ADD     A,#0x1a
   \   000033   F8           MOV     R0,A
   \   000034   EB           MOV     A,R3
   \   000035   3400         ADDC    A,#0x0
   \   000037   F9           MOV     R1,A
    546                    buf[0] = WIRE_PING_CMD;
   \   000038   85..82       MOV     DPL,?XSP + 0
   \   00003B   85..83       MOV     DPH,?XSP + 1
   \   00003E   7451         MOV     A,#0x51
   \   000040   F0           MOVX    @DPTR,A
    547          					buf[1] = LO_UINT16(pkt->srcAddr.addr.shortAddr);//源地址
   \   000041   EA           MOV     A,R2
   \   000042   2406         ADD     A,#0x6
   \   000044   FC           MOV     R4,A
   \   000045   EB           MOV     A,R3
   \   000046   3400         ADDC    A,#0x0
   \   000048   FD           MOV     R5,A
   \   000049   8C82         MOV     DPL,R4
   \   00004B   8D83         MOV     DPH,R5
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   C0E0         PUSH    A
   \   000050   7401         MOV     A,#0x1
   \   000052   12....       LCALL   ?XSTACK_DISP0_8
   \   000055   D0E0         POP     A
   \   000057   F0           MOVX    @DPTR,A
    548          					buf[2] = HI_UINT16(pkt->srcAddr.addr.shortAddr);//这个包最终会发送到协调器，意义为这个点与源地址之间的信号情况
   \   000058   8C82         MOV     DPL,R4
   \   00005A   8D83         MOV     DPH,R5
   \   00005C   A3           INC     DPTR
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   C0E0         PUSH    A
   \   000060   7402         MOV     A,#0x2
   \   000062   12....       LCALL   ?XSTACK_DISP0_8
   \   000065   D0E0         POP     A
   \   000067   F0           MOVX    @DPTR,A
    549                    buf[1] = pkt->LinkQuality;
   \   000068   EA           MOV     A,R2
   \   000069   2416         ADD     A,#0x16
   \   00006B   12....       LCALL   ??Subroutine9_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   00006E   C0E0         PUSH    A
   \   000070   7401         MOV     A,#0x1
   \   000072   12....       LCALL   ?XSTACK_DISP0_8
   \   000075   D0E0         POP     A
   \   000077   F0           MOVX    @DPTR,A
    550                    buf[2] = pkt->SecurityUse;
   \   000078   EA           MOV     A,R2
   \   000079   2419         ADD     A,#0x19
   \   00007B   12....       LCALL   ??Subroutine9_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   00007E   C0E0         PUSH    A
   \   000080   7402         MOV     A,#0x2
   \   000082   12....       LCALL   ?XSTACK_DISP0_8
   \   000085   D0E0         POP     A
   \   000087   F0           MOVX    @DPTR,A
    551                    buf[3] = u8p[0];
   \   000088   8882         MOV     DPL,R0
   \   00008A   8983         MOV     DPH,R1
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   C0E0         PUSH    A
   \   00008F   7403         MOV     A,#0x3
   \   000091   12....       LCALL   ?XSTACK_DISP0_8
   \   000094   D0E0         POP     A
   \   000096   12....       LCALL   ?Subroutine1 & 0xFFFF
    552                    buf[4] = u8p[1];
   \                     ??CrossCallReturnLabel_0:
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   C0E0         PUSH    A
   \   00009C   7404         MOV     A,#0x4
   \   00009E   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A1   D0E0         POP     A
   \   0000A3   12....       LCALL   ?Subroutine1 & 0xFFFF
    553                    buf[5] = u8p[2];
   \                     ??CrossCallReturnLabel_1:
   \   0000A6   A3           INC     DPTR
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   C0E0         PUSH    A
   \   0000AA   7405         MOV     A,#0x5
   \   0000AC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AF   D0E0         POP     A
   \   0000B1   12....       LCALL   ?Subroutine1 & 0xFFFF
    554                    buf[6] = u8p[3];
   \                     ??CrossCallReturnLabel_2:
   \   0000B4   A3           INC     DPTR
   \   0000B5   A3           INC     DPTR
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   C0E0         PUSH    A
   \   0000B9   7406         MOV     A,#0x6
   \   0000BB   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BE   D0E0         POP     A
   \   0000C0   F0           MOVX    @DPTR,A
    555          					buf[7] = (uint8)pkt->rssi;//dBm
   \   0000C1   EA           MOV     A,R2
   \   0000C2   2418         ADD     A,#0x18
   \   0000C4   12....       LCALL   ??Subroutine9_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   0000C7   C0E0         PUSH    A
   \   0000C9   7407         MOV     A,#0x7
   \   0000CB   12....       LCALL   ?XSTACK_DISP0_8
   \   0000CE   D0E0         POP     A
   \   0000D0   F0           MOVX    @DPTR,A
    556                    guu_finally_report(FROM_WIRE,10,buf);
   \   0000D1                ; Setup parameters for call to function guu_finally_report
   \   0000D1   85..82       MOV     DPL,?XSP + 0
   \   0000D4   85..83       MOV     DPH,?XSP + 1
   \   0000D7   AC82         MOV     R4,DPL
   \   0000D9   AD83         MOV     R5,DPH
   \   0000DB   7A0A         MOV     R2,#0xa
   \   0000DD   7901         MOV     R1,#0x1
   \   0000DF   12....       LCALL   ??guu_finally_report?relay
    557                    return;
   \   0000E2   802A         SJMP    ??GenericApp_WirelessMSGCB_3
    558               }
    559              else if(pkt->cmd.Data[0]==0x67)//广播的Groups 消息
    560              {
    561                /*
    562                  if(pkt->cmd.DataLength >2)
    563                  {
    564                    for(i=0;i<GROUPS;i++)
    565                    {
    566                      if(guu_safe_level[i] == pkt->cmd.Data[1]){ j=111;break;}
    567                    }
    568                  }
    569                  if(j== 111)
    570                  {
    571                    parse_procotol( &pkt->cmd.Data[2],  pkt->cmd.DataLength-2 , pkt->srcAddr.addr.shortAddr,FROM_WIRE); 
    572                    j= 0;
    573                  }
    574                */
    575              }
    576              if(pkt->cmd.DataLength > 2)//至少3个数字,头+长度+FCs
   \                     ??GenericApp_WirelessMSGCB_2:
   \   0000E4   EA           MOV     A,R2
   \   0000E5   2420         ADD     A,#0x20
   \   0000E7   F582         MOV     DPL,A
   \   0000E9   EB           MOV     A,R3
   \   0000EA   3400         ADDC    A,#0x0
   \   0000EC   F583         MOV     DPH,A
   \   0000EE   C3           CLR     C
   \   0000EF   E0           MOVX    A,@DPTR
   \   0000F0   9403         SUBB    A,#0x3
   \   0000F2   A3           INC     DPTR
   \   0000F3   E0           MOVX    A,@DPTR
   \   0000F4   9400         SUBB    A,#0x0
   \   0000F6   4016         JC      ??GenericApp_WirelessMSGCB_3
    577              {
    578                guu_data_cb(pkt); 
   \   0000F8                ; Setup parameters for call to function guu_data_cb
   \   0000F8   12....       LCALL   ??guu_data_cb?relay
   \   0000FB   8011         SJMP    ??GenericApp_WirelessMSGCB_3
    579              }
    580                break;
    581            default:
    582              {
    583                guu_usart(pkt->cmd.Data,pkt->cmd.DataLength);
   \                     ??GenericApp_WirelessMSGCB_1:
   \   0000FD                ; Setup parameters for call to function guu_usart
   \   0000FD   EA           MOV     A,R2
   \   0000FE   2420         ADD     A,#0x20
   \   000100   12....       LCALL   ??Subroutine9_0 & 0xFFFF
    584              }break;
   \                     ??CrossCallReturnLabel_19:
   \   000103   F9           MOV     R1,A
   \   000104   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000107   FA           MOV     R2,A
   \   000108   A3           INC     DPTR
   \   000109   E0           MOVX    A,@DPTR
   \   00010A   FB           MOV     R3,A
   \   00010B   12....       LCALL   ??guu_usart?relay
   \                     ??GenericApp_WirelessMSGCB_3:
   \   00010E   740A         MOV     A,#0xa
    585            }
   \   000110   02....       LJMP    ?Subroutine0 & 0xFFFF
    586          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   EA           MOV     A,R2
   \   000001   2422         ADD     A,#0x22
   \   000003                REQUIRE ??Subroutine9_0
   \   000003                ; // Fall through to label ??Subroutine9_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine9_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EB           MOV     A,R3
   \   000003                REQUIRE ??Subroutine10_0
   \   000003                ; // Fall through to label ??Subroutine10_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   8882         MOV     DPL,R0
   \   000003   8983         MOV     DPH,R1
   \   000005   A3           INC     DPTR
   \   000006   22           RET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_WirelessMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_WirelessMSGCB

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "GenericApp">`:
   \   000000   47656E65     DB "GenericApp"
   \            72696341
   \            707000  
    587          
    588          /*********************************************************************
    589           * @fn      GenericApp_SendTheMessage
    590           *
    591           * @brief   Send "the" message.
    592           *
    593           * @param   none
    594           *
    595           * @return  none
    596           */
    597          static void GenericApp_SendTheMessage( void )
                             ^
Warning[Pe177]: function "GenericApp_SendTheMessage" was declared but never
          referenced
    598          {
    599            char theMessageData[] = "Hello World";
    600          
    601            if ( AF_DataRequest( &GenericApp_DstAddr, &GenericApp_epDesc,
    602                                 GENERICAPP_CLUSTERID,
    603                                 (byte)osal_strlen( theMessageData ) + 1,
    604                                 (byte *)&theMessageData,
    605                                 &GenericApp_TransID,
    606                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    607            {
    608              // Successfully requested to be sent.
    609            }
    610            else
    611            {
    612              // Error occurred in request to send.
    613            }
    614          }
    615          
    616          #if defined( IAR_ARMCM3_LM )
    617          /*********************************************************************
    618           * @fn      GenericApp_ProcessRtosMessage
    619           *
    620           * @brief   Receive message from RTOS queue, send response back.
    621           *
    622           * @param   none
    623           *
    624           * @return  none
    625           */
    626          static void GenericApp_ProcessRtosMessage( void )
    627          {
    628            osalQueue_t inMsg;
    629          
    630            if ( osal_queue_receive( OsalQueue, &inMsg, 0 ) == pdPASS )
    631            {
    632              uint8 cmndId = inMsg.cmnd;
    633              uint32 counter = osal_build_uint32( inMsg.cbuf, 4 );
    634          
    635              switch ( cmndId )
    636              {
    637                case CMD_INCR:
    638                  counter += 1;  /* Increment the incoming counter */
    639                                 /* Intentionally fall through next case */
    640          
    641                case CMD_ECHO:
    642                {
    643                  userQueue_t outMsg;
    644          
    645                  outMsg.resp = RSP_CODE | cmndId;  /* Response ID */
    646                  osal_buffer_uint32( outMsg.rbuf, counter );    /* Increment counter */
    647                  osal_queue_send( UserQueue1, &outMsg, 0 );  /* Send back to UserTask */
    648                  break;
    649                }
    650                
    651                default:
    652                  break;  /* Ignore unknown command */    
    653              }
    654            }
    655          }
    656          #endif
    657          
    658          /*********************************************************************
    659           */

   Maximum stack usage in bytes:

     Function                      ISTACK PSTACK XSTACK
     --------                      ------ ------ ------
     GenericApp_HandleKeys             0      0     24
       -> get_key_type                 0      0     20
       -> exec_io                      0      0     20
       -> exec_io_cmd                  0      0     20
     GenericApp_Init                   0      0      9
       -> afRegister                   0      0     18
       -> RegisterForKeys              0      0     18
       -> HalLcdWriteString            0      0     18
       -> ZDO_RegisterForZDOMsg        0      0     18
       -> ZDO_RegisterForZDOMsg        0      0     18
     GenericApp_ProcessEvent           0      0     18
       -> osal_msg_receive             0      0     28
       -> guu_mt_app_msg_cb            0      0     28
       -> osal_msg_deallocate          0      0     28
       -> osal_msg_receive             0      0     28
       -> ZDO_ParseEPListRsp           0      0     28
       -> guu_osal_mem_free            0      0     28
       -> GenericApp_HandleKeys        0      0     28
       -> GenericApp_WirelessMSGCB     0      0     28
       -> guu_osal_nv_read             0      0     36
       -> guu_osal_nv_write            0      0     36
       -> guu_usart                    0      0     28
       -> osal_set_event               0      0     28
     GenericApp_WirelessMSGCB          1      0     33
       -> guu_finally_report           0      0     38
       -> guu_data_cb                  0      0     38
       -> guu_usart                    0      0     38


   Segment part sizes:

     Function/Label                   Bytes
     --------------                   -----
     _A_P0                               1
     _A_P1                               1
     _A_P2                               1
     GenericApp_ClusterList              2
     GenericApp_SimpleDesc              12
     GenericApp_epDesc                   6
     GenericApp_TaskID                   1
     GenericApp_NwkState                 1
     GenericApp_TransID                  1
     GenericApp_DstAddr                 12
     GenericApp_Init                   134
     ??Subroutine7_0                     5
     GenericApp_ProcessEvent           333
     ??Subroutine10_0                    6
     GenericApp_HandleKeys             198
     ?Subroutine0                        3
     ?Subroutine3                        7
     ??Subroutine8_0                    11
     ?Subroutine2                       14
     ?Subroutine5                       10
     ?Subroutine6                       15
     GenericApp_WirelessMSGCB          275
     ?Subroutine4                        3
     ??Subroutine9_0                     3
     ?Subroutine1                        7
     ??GenericApp_Init?relay             6
     ??GenericApp_ProcessEvent?relay     6
     ??GenericApp_HandleKeys?relay       6
     ??GenericApp_WirelessMSGCB?relay    6
     ?<Constant "GenericApp">           11

 
 1 024 bytes in segment BANKED_CODE
    24 bytes in segment BANK_RELAYS
     3 bytes in segment SFR_AN
    25 bytes in segment XDATA_ROM_C
    21 bytes in segment XDATA_Z
 
 1 048 bytes of CODE  memory
    25 bytes of CONST memory
     0 bytes of DATA  memory (+ 3 bytes shared)
    21 bytes of XDATA memory

Errors: none
Warnings: 3
